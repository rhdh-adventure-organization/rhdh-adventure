<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup :: Red Hat Developer Hub Adventure</title>
    <link rel="canonical" href="https://blog.jromanmartin.io/rhdh-adventure/rhdh-adventure/index.html/rhdh-adventure/challenge-02-solution.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://blog.jromanmartin.io/rhdh-adventure/rhdh-adventure/index.html">Red Hat Developer Hub Adventure</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhdh-adventure" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-01.html">ğŸš€ The Adventure Begins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-01.html#helmchart">ğŸ“¦ Helm Chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-01.html#operator">ğŸ‘· Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-02.html">ğŸ¨ Make It Your Own</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-02.html#configuration">ğŸ› ï¸ External configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-02.html#title">Â©ï¸ Title it!</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-02.html#colors">ğŸŒˆ Looking better</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-03.html">ğŸ‘¨â€ğŸ’» Lock It Down</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-03.html#github-auth">ğŸ”‘ Authentication with GitHub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-03.html#gitlab-auth">ğŸ”‘ Authentication with GitLab</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-03.html#rbac">ğŸ›‚ You won&#8217;t break it</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-04.html">ğŸ•µğŸ»â€â™‚ï¸ Import An Existing App</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-04.html#declare">ğŸ“ Declare it</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-04.html#import">ğŸ“‚ Import it</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-05.html">ğŸ§¾ Streamline Future App Dev</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-05.html#softwaretemplate">ğŸ’€ Software Template</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-05.html#onboard">ğŸ›¬ Onboarding</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-06.html">ğŸ”Œ Unlock New Capabilities</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-06.html#dynamicplugins">ğŸ¦„ Dynamic Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-07.html">ğŸ”¬ Put It Under The Microscope</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-07.html#tools">ğŸ§° Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-07.html#metrics">ğŸ‘¨â€ğŸ”¬ Metrics</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Developer Hub Adventure</a></li>
    <li><a href="challenge-02-solution.html">Setup</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rmarting/rhdh-adventure/edit/master/documentation/modules/ROOT/pages/challenge-02-solution.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Setup</h1>
<div class="sect1">
<h2 id="intro-solution"><a class="anchor" href="#intro-solution"></a>ğŸ§ğŸ¨ Make It Your Own Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Welcome! Don&#8217;t worry about being hereâ€”it&#8217;s absolutely okay! This section provides an example solution
to the challenge, offering a step-by-step implementation as a reference to guide you.</p>
</div>
<div class="paragraph">
<p>Remember, this is just one way to solve the challenge, and your approach might differ depending on
your creativity or specific requirements. Feel free to explore and adapt the solution to make it your own.
The goal is to help you understand the process and give you the confidence to tackle similar challenges
in the future. Let' 's dive in together! ğŸ§ğŸš€</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-solution"><a class="anchor" href="#configuration-solution"></a>ğŸ§ğŸ› ï¸ External configuration Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Developer Hub is very extensible and customizable, so the final configuration could be so long
and extended making hard its maintenance. There is a proper way to customize it using external resources
such as <code>ConfigMaps</code> and <code>Secrets</code>. Those resources can be added to the default configuration to set up
the instance completely.</p>
</div>
<div class="paragraph">
<p>This solution will use a <code>ConfigMap</code> identified as <code>rhdh-app-config</code> to extend the default configuration
applied during the installation. Here a simple use case:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
kind: ConfigMap
apiVersion: v1
metadata:
  name: rhdh-app-config
data:
  rhdh-app-config.yaml: |
    organization:
      name: "My Organization"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Customizing Red Hat Developer Hub will require at some point the usage of sensitive data (e.g: credentials, tokens&#8230;&#8203;)
and we must declare in the most secure way. Using a Secret we could declare those values properly and add
into the configuration too. For example, the <code>BACKEND_SECRET</code> variable is defined to be used for service
to service authentication. Here a simple use case:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: v1
kind: Secret
metadata:
  name: rhdh-secrets
stringData:
  # Secrets Configuration
  BACKEND_SECRET: this-is-the-backend-secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can apply it using the <code>oc</code> command as:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/challenge-02/rhdh-app-config-cm-01.yaml
oc apply -f ./documentation/modules/ROOT/examples/challenge-02/rhdh-secrets-secret.yaml</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the previous challenge, we defined the <code>basedomain</code> variable to be used in different configurations.
We can add that variable into the <code>rhdh-secrets</code> object for that. This patch command will add it:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc patch secret rhdh-secrets -p '{"stringData":{"basedomain":"'"${basedomain}"'"}}'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Don&#8217;t forget to create those objects inside of the namespace your are deploying Red Hat Developer Hub.
Remember the usage of <code>rhdh-by-helm</code> namespace for an instance managed by the Helm Chart,
and <code>rhdh-by-operator</code> namespace for an instance managed by the Operator.
</td>
</tr>
</table>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_by-helm-chart"></a>By Helm Chart</p>
</li>
<li>
<p><a id="tabset1_by-operator"></a>By Operator</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_by-helm-chart">
<div class="paragraph">
<p>Red Hat Developer Hub Helm Chart provides an extension to declare extra configuration by ConfigMap and Secrets.
The definition of the resources described above will be applying the next configuration into the <code>values.yaml</code> file.
Here an example of that configuration:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">global:
  clusterRouterBase: "${basedomain}"
upstream:
  backstage:
    extraAppConfig:
      - configMapRef: rhdh-app-config
        filename: rhdh-app-config.yaml
    extraEnvVarsSecrets:
      - rhdh-secrets</code></pre>
</div>
</div>
<div class="paragraph">
<p>To apply the new configuration setup, we need to upgrade our Helm Chart release:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">helm upgrade --install rhdh \
    openshift-helm-charts/redhat-developer-hub \
    -f ./documentation/modules/ROOT/examples/challenge-02/values.yaml \
    --set global.clusterRouterBase=$basedomain</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_by-operator">
<div class="paragraph">
<p>The Backstage CRD provides an extension to declare extra configuration by ConfigMap and Secrets.
Here an example of that configuration:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: rhdh.redhat.com/v1alpha2
kind: Backstage
metadata:
  name: rhdh
spec:
  deployment:
    patch:
      spec:
        replicas: 1
  application:
    appConfig:
      mountPath: /opt/app-root/src
      configMaps:
      - name: rhdh-app-config
    extraFiles:
      mountPath: /opt/app-root/src
    extraEnvs:
      envs:
        # Disabling TLS verification
        - name: NODE_TLS_REJECT_UNAUTHORIZED
          value: '0'
      secrets:
        - name: rhdh-secrets
    route:
      enabled: true
  database:
    enableLocalDb: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To apply the new configuration setup, we need to update the Backstage object:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/challenge-02/rhdh-instance.yaml</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="title-solution"><a class="anchor" href="#title-solution"></a>ğŸ§Â©ï¸ Title it Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the configuration objects created previously add new configuration is easy, just add the new
configuration there. For example, to define the title of our instance, update the <code>rhdh-app-config</code>
configmap adding the attribute <code>app.title</code> as:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: rhdh-app-config
data:
  rhdh-app-config.yaml: |
    # Other configuration
    app:
      title: "My Adventure with Red Hat Developer Hub"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And full example from the previous activity:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
kind: ConfigMap
apiVersion: v1
metadata:
  name: rhdh-app-config
data:
  rhdh-app-config.yaml: |
    organization:
      name: "My Organization"
    app:
      title: "My Adventure with Red Hat Developer Hub"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applying the new configuration by updating the ConfigMap:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/challenge-02/rhdh-app-config-cm-02.yaml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running a Red Hat Developer Hub instance managed by the Operator, every time a configmap
or secret included in the configuration is updated, the operator will trigger a redeploy of the
instance. You don&#8217;t need to do anything else.</p>
</div>
<div class="paragraph">
<p>However, if you are using the Helm Chart, then a deployment restart must be done. You can trigger it
with the following command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc rollout restart deployment/rhdh-developer-hub</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can verify that our landing page is similar to:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/challenge-02/rhdh-new-title.png" alt="rhdh new title">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="colors-solution"><a class="anchor" href="#colors-solution"></a>ğŸ§ğŸŒˆ Looking better Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Developer Hub includes a default theme aligned with Red Hat branding products style, however, that
theme is customizable too. The following extension of the <code>rhdh-app-config</code> ConfigMap will define different
colour schema:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: rhdh-app-config
data:
  rhdh-app-config.yaml: |
    app:
      # Other application configuration
      branding:
        theme:
          light:
            primaryColor: '#38be8b'
            headerColor1: 'hsl(204 100% 71%)'
            headerColor2: 'color(a98-rgb 1 0 0)'
            navigationIndicatorColor: '#be0000'
          dark:
            primaryColor: '#ab75cf'
            headerColor1: '#0000d0'
            headerColor2: 'rgb(255 246 140)'
            navigationIndicatorColor: '#f4eea9'</code></pre>
</div>
</div>
<div class="paragraph">
<p>And full example from the previous activity:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
kind: ConfigMap
apiVersion: v1
metadata:
  name: rhdh-app-config
data:
  rhdh-app-config.yaml: |
    organization:
      name: "My Organization"
    app:
      title: "My Adventure with Red Hat Developer Hub"
      branding:
        theme:
          light:
            primaryColor: '#38be8b'
            headerColor1: 'hsl(204 100% 71%)'
            headerColor2: 'color(a98-rgb 1 0 0)'
            navigationIndicatorColor: '#be0000'
          dark:
            primaryColor: '#ab75cf'
            headerColor1: '#0000d0'
            headerColor2: 'rgb(255 246 140)'
            navigationIndicatorColor: '#f4eea9'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applying the new configuration by updating the ConfigMap:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/challenge-02/rhdh-app-config-cm-03.yaml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running a Red Hat Developer Hub instance managed by the Operator, every time a configmap
or secret included in the configuration is updated, the operator will trigger a redeploy of the
instance. You don&#8217;t need to do anything else.</p>
</div>
<div class="paragraph">
<p>However, if you are using the Helm Chart, then a deployment restart must be done. You can trigger it
with the following command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc rollout restart deployment/rhdh-developer-hub</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can verify that our landing page is similar to:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/challenge-02/rhdh-new-look-and-feel.png" alt="rhdh new look and feel">
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
