<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup :: Red Hat Developer Hub Adventure</title>
    <link rel="canonical" href="https://blog.jromanmartin.io/rhdh-adventure/rhdh-adventure/index.html/rhdh-adventure/01-setup.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://blog.jromanmartin.io/rhdh-adventure/rhdh-adventure/index.html">Red Hat Developer Hub Adventure</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhdh-adventure" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">The Stages</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-01.html">🚀 The Adventure Begins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-01.html#helmchart">📦 Helm Chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-01.html#operator">👷 Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-02.html">🎨 Make It Your Own</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-02.html#configuration">🛠️ External configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-02.html#title">©️ Title it!</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-02.html#colors">🌈 Looking better</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-03.html">👨‍💻 Lock It Down</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-03.html#github-auth">🔑 Authentication with GitHub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-03.html#gitlab-auth">🔑 Authentication with GitLab</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-03.html#rbac">🛂 You won&#8217;t break it</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-04.html">🕵🏻‍♂️ Import An Existing App</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-04.html#declare">📝 Declare it</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-04.html#import">📂 Import it</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-05.html">🧾 Streamline Future App Dev</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-05.html#softwaretemplate">💀 Software Template</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-05.html#onboard">🛬 Onboarding</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-06.html">🔌 Unlock New Capabilities</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-06.html#dynamicplugins">🦄 Dynamic Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="challenge-07.html">🔬 Put It Under The Microscope</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-07.html#tools">🧰 Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="challenge-07.html#metrics">👨‍🔬 Metrics</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Developer Hub Adventure</a></li>
    <li><a href="01-setup.html">Setup</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rmarting/rhdh-adventure/edit/master/documentation/modules/ROOT/pages/01-setup.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Setup</h1>
<div class="sect1">
<h2 id="prerequisite"><a class="anchor" href="#prerequisite"></a>Prerequisite CLI tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following CLI tools are required for running the exercises in this adventure.
Please have them installed and configured before you get started with any of the tutorial chapters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Tool</strong></th>
<th class="tableblock halign-center valign-top"><strong>macOS</strong></th>
<th class="tableblock halign-center valign-top"><strong>Fedora</strong></th>
<th class="tableblock halign-center valign-top"><strong>windows</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>oc client 4.16.9</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.16.9/openshift-client-mac-4.16.9.tar.gz">Download</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.16.9/openshift-client-linux-4.16.9.tar.gz">Download</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.16.9/openshift-client-windows-4.16.9.zip">Download</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>helm client 3.16.4</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://get.helm.sh/helm-v3.16.4-darwin-amd64.tar.gz">Download</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://get.helm.sh/helm-v3.16.4-linux-386.tar.gz">Download</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://get.helm.sh/helm-v3.16.4-windows-amd64.zip">Download</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="downloadtutorial"><a class="anchor" href="#downloadtutorial"></a>Get tutorial sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we start setting up the environment, let’s clone the tutorial sources and set the <code>TUTORIAL_HOME</code> environment variable to point to the root directory of the tutorial:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone <a href="https://github.com/rmarting/rhdh-adventure.git" class="bare">https://github.com/rmarting/rhdh-adventure.git</a> rhdh-adventure</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export TUTORIAL_HOME="$(pwd)/rhdh-adventure"</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ocpsetup"><a class="anchor" href="#ocpsetup"></a>Set up OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This adventure requires a Red Hat OpenShift Container Platform 4.16.9 available and with a set of operators
installed before starting this adventure.</p>
</div>
<div class="paragraph">
<p>If you do not have a Red Hat OpenShift Container Platform, you can request one at
<a href="https://catalog.demo.redhat.com/catalog">Red Hat Demo Platform</a> system. From the catalog of options the
<a href="https://catalog.demo.redhat.com/catalog?search=openshift&amp;item=babylon-catalog-prod%2Fsandboxes-gpte.ocp-wksp.prod">Red Hat OpenShift Container Platform Cluster (AWS)</a> is the most suitable for this.</p>
</div>
<div class="paragraph">
<p>Another option is the usage of an instance of Developer Sandbox for Red Hat OpenShift. If you are interested,
please, follow the instructions described <a href="01-setup-sandbox.html" class="xref page">here</a>.</p>
</div>
<div class="paragraph">
<p>Once you have your Red Hat OpenShift Container Platform instance ready, the following instructions must be done
with a user with <code>cluster-admin</code> privileges. This is because a set of OpenShift Operators will be installed.</p>
</div>
<div class="sect2">
<h3 id="ocpsetup-certmanager"><a class="anchor" href="#ocpsetup-certmanager"></a>Install Cert Manager</h3>
<div class="paragraph">
<p>Before installing the Cert Manager Operator, check it:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get csv -n cert-manager-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>It the output is similar to, then it is not needed to install it.</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                            DISPLAY                                       VERSION   REPLACES                        PHASE
cert-manager-operator.v1.14.1   cert-manager Operator for Red Hat OpenShift   1.14.1    cert-manager-operator.v1.14.0   Succeeded</code></pre>
</div>
</div>
<div class="paragraph">
<p>To install it:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/setup/cert-manager-operator.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ocpsetup-rhdh-operator"><a class="anchor" href="#ocpsetup-rhdh-operator"></a>Install Red Hat Developer Hub Operator</h3>
<div class="paragraph">
<p>This is an adventure about Red Hat Developer Hub and there is a challenge to play with the features
provided by the Operator. Install the operator is just apply the next manifest:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: v1
kind: Namespace
metadata:
  name: rhdh-operator
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  annotations:
    olm.providedAPIs: Backstage.v1alpha1.rhdh.redhat.com
  name: rhdh-operator-og
  namespace: rhdh-operator
spec:
  upgradeStrategy: Default
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  labels:
    operators.coreos.com/rhdh.rhdh-operator: ""
  name: rhdh
  namespace: rhdh-operator
spec:
  name: rhdh
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  channel: fast
  startingCSV: rhdh-operator.v1.4.0
  installPlanApproval: Automatic</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/setup/rhdh-operator.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The operator is installed in the <code>rhdh-operator</code> namespace:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">on 🎩 ❯ oc get csv -n rhdh-operator
NAME                   DISPLAY                          VERSION   REPLACES               PHASE
rhdh-operator.v1.4.0   Red Hat Developer Hub Operator   1.4.0     rhdh-operator.v1.3.1   Succeeded</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ocpsetup-gitlab"><a class="anchor" href="#ocpsetup-gitlab"></a>Install GitLab</h3>
<div class="paragraph">
<p>Some challenges require to integrate Red Hat Developer Hub with GitHub or GitLab, you can use public
instances of those servers, however, there is an option to install a local instance of GitLab in your
OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>Follow this instructions if you want to have your own instance of GitLab.</p>
</div>
<div class="paragraph">
<p>Deploy the GitLab Operator, available in Red Hat OpenShift Operator Lifecyle Manager:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/setup/gitlab-operator.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This operator will be installed in the <code>gitlab-system</code> namespace:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">on 🎩 ❯ oc get csv -n gitlab-system
NAME                                DISPLAY    VERSION   REPLACES                            PHASE
gitlab-operator-kubernetes.v1.8.2   GitLab     1.8.2     gitlab-operator-kubernetes.v1.8.1   Succeeded</code></pre>
</div>
</div>
<div class="paragraph">
<p>To install a local instance of GitLab this command will create one. It will the base domain of the
OpenShift cluster to public it externally.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export basedomain=$(oc get ingresscontroller -n openshift-ingress-operator default -o jsonpath='{.status.domain}')
envsubst &lt; ./documentation/modules/ROOT/examples/setup/gitlab.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>basedomain</code> variable is used later in different challenges. Don&#8217;t forget it!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Deploying GitLab takes some time, so check its status as <code>Running</code> before continuing with next steps:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get gitlabs gitlab -o jsonpath='{.status.phase}' -n gitlab-system</code></pre>
</div>
</div>
<div class="paragraph">
<p>The GitLab instance is available at</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo <a href="https://gitlab.$basedomain" class="bare">https://gitlab.$basedomain</a></code></pre>
</div>
</div>
<div class="paragraph">
<p>GitLab is now accessible with user <code>root/&lt;password in "gitlab-gitlab-initial-root-password" secret&gt;</code>.
To get the plain value of that password:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get secret gitlab-gitlab-initial-root-password -o jsonpath='{.data.password}' -n gitlab-system | base64 -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setup GitLab with some initial configuration:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./documentation/modules/ROOT/examples/setup/gitlab-setup.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The initial configuration requires to push some content into GitLab, you should use the <code>user1</code> credentials to do it.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If GitLab is deployed using self-signed certificates, you can get the following exception:</p>
</div>
<div class="paragraph">
<p><code>SSL certificate problem: self-signed certificate in certificate chain</code></p>
</div>
<div class="paragraph">
<p>In that case, execute the script with the <code>--ssl_certs_self_signed=y</code> argument.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./documentation/modules/ROOT/examples/setup/gitlab-setup.sh --ssl_certs_self_signed=y</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This script will do the following:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Create two groups:

- team-a
- team-b

Create two users/passwords:

- user1/@abc1cde2
- user2/@abc1cde2

Ensure `user1` belongs to `team-a` and `user2` belongs to `team-b`.

Create a repo called `sample-app` under `team-a` add the `catalog-info.yaml` and `users-groups.yaml` at the root of the repo.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ocpsetup-gitlab-runner"><a class="anchor" href="#ocpsetup-gitlab-runner"></a>Deploy GitLab runner</h3>
<div class="paragraph">
<p>GitLab instance can be extended installing a GitLab Runner to enable some automations.
This section will install the GitLab Runner operator and prepare to be used by the GitLab instance:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f ./documentation/modules/ROOT/examples/setup/gitlab-runner-operator.yaml -n gitlab-system</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test the installation</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">on 🎩 ❯ oc get csv -n gitlab-system
NAME                             DISPLAY         VERSION   REPLACES                         PHASE
gitlab-runner-operator.v1.32.0   GitLab Runner   1.32.0    gitlab-runner-operator.v1.31.0   Succeeded</code></pre>
</div>
</div>
<div class="paragraph">
<p>The technical docs will be created as part of the CI pipelines of the components, so
we need to set up the GitLab instance to run pipelines and use some variables to
identify the new bucket to store the results.</p>
</div>
<div class="paragraph">
<p>Deploy a GitLab runner to run pipelines:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">envsubst &lt; ./documentation/modules/ROOT/examples/setup/gitlab-runner.yaml | oc apply -n gitlab-system -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>Matomo</p>
</div>
<div class="paragraph">
<p>oc new-project matomo</p>
</div>
<div class="paragraph">
<p>helm install my-matomo</p>
</div>
<div class="paragraph">
<p>helm upgrade --install my-matomo \
    --set matomoUsername=admin,matomoPassword=password \
    --set ingress.enabled=true \
    --set ingress.hostname=matomo.apps.cluster-fsnjt.fsnjt.sandbox506.opentlc.com \
    oci://registry-1.docker.io/bitnamicharts/matomo</p>
</div>
<div class="paragraph">
<p>oc expose svc my-matomo</p>
</div>
<div class="paragraph">
<p>helm repo add petbattle <a href="https://petbattle.github.io/helm-charts" class="bare">https://petbattle.github.io/helm-charts</a>
helm upgrade --install pb-matomo \
    <a href="https://petbattle.github.io/helm-charts/matomo" class="bare">https://petbattle.github.io/helm-charts/matomo</a> --version=4.1.1+01</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
